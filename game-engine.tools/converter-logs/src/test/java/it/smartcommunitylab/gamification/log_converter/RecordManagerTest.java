package it.smartcommunitylab.gamification.log_converter;

import org.junit.Test;

import it.smartcommunitylab.gamification.log_converter.beans.Record;
import it.smartcommunitylab.gamification.log_converter.beans.RecordType;
import it.smartcommunitylab.gamification.log_converter.manager.RecordManager;

public class RecordManagerTest {

	@Test
	public void testAction() {
		RecordManager recordManager = new RecordManager();

		String recordContent = "INFO - \"57ac710fd4c6ac7872b0e7a1\" \"24642\" 7e287737-ca7a-4d02-ad81-5295cc6a614c 1477087464452 1477087464465 type=Action action=\"save_itinerary\" payload=\"{\"walkDistance\":1.9532716237340484}\" oldState=\"[{\"id\":\"1\",\"name\":\"public transport aficionado\",\"badgeEarned\":[]},{\"id\":\"1\",\"name\":\"leaderboard top 3\",\"badgeEarned\":[]},{\"id\":\"1\",\"name\":\"green leaves\",\"score\":47.0,\"periods\":{\"weekly\":{\"start\":1472853600000,\"period\":604800000,\"identifier\":\"weekly\",\"instances\":[{\"score\":0.0,\"start\":1472853600000,\"end\":1473458400000,\"index\":0},{\"score\":0.0,\"start\":1473458400000,\"end\":1474063200000,\"index\":1},{\"score\":0.0,\"start\":1474063200000,\"end\":1474668000000,\"index\":2},{\"score\":0.0,\"start\":1474668000000,\"end\":1475272800000,\"index\":3},{\"score\":0.0,\"start\":1475272800000,\"end\":1475877600000,\"index\":4},{\"score\":0.0,\"start\":1475877600000,\"end\":1476482400000,\"index\":5},{\"score\":47.0,\"start\":1476482400000,\"end\":1477087200000,\"index\":6}]}}},{\"id\":\"1\",\"name\":\"BikeSharing_Km\",\"score\":0.0,\"periods\":{\"weekly\":{\"start\":1472853600000,\"period\":604800000,\"identifier\":\"weekly\",\"instances\":[]}}},{\"id\":\"1\",\"name\":\"bike sharing pioneer\",\"badgeEarned\":[]},{\"id\":\"1\",\"name\":\"Walk_Trips\",\"score\":2.0,\"periods\":{\"weekly\":{\"start\":1472853600000,\"period\":604800000,\"identifier\":\"weekly\",\"instances\":[{\"score\":0.0,\"start\":1472853600000,\"end\":1473458400000,\"index\":0},{\"score\":0.0,\"start\":1473458400000,\"end\":1474063200000,\"index\":1},{\"score\":0.0,\"start\":1474063200000,\"end\":1474668000000,\"index\":2},{\"score\":0.0,\"start\":1474668000000,\"end\":1475272800000,\"index\":3},{\"score\":0.0,\"start\":1475272800000,\"end\":1475877600000,\"index\":4},{\"score\":0.0,\"start\":1475877600000,\"end\":1476482400000,\"index\":5},{\"score\":2.0,\"start\":1476482400000,\"end\":1477087200000,\"index\":6}]}}},{\"id\":\"1\",\"name\":\"BikeSharing_Trips\",\"score\":0.0,\"periods\":{\"weekly\":{\"start\":1472853600000,\"period\":604800000,\"identifier\":\"weekly\",\"instances\":[]}}},{\"id\":\"1\",\"name\":\"Car_Trips\",\"score\":0.0,\"periods\":{\"weekly\":{\"start\":1472853600000,\"period\":604800000,\"identifier\":\"weekly\",\"instances\":[]}}},{\"id\":\"1\",\"name\":\"recommendations\",\"badgeEarned\":[]},{\"id\":\"1\",\"name\":\"Car_Km\",\"score\":0.0,\"periods\":{\"weekly\":{\"start\":1472853600000,\"period\":604800000,\"identifier\":\"weekly\",\"instances\":[]}}},{\"id\":\"1\",\"name\":\"Train_Trips\",\"score\":0.0,\"periods\":{\"weekly\":{\"start\":1472853600000,\"period\":604800000,\"identifier\":\"weekly\",\"instances\":[]}}},{\"id\":\"1\",\"name\":\"Bike_Km\",\"score\":0.0,\"periods\":{\"weekly\":{\"start\":1472853600000,\"period\":604800000,\"identifier\":\"weekly\",\"instances\":[]}}},{\"id\":\"1\",\"name\":\"Transit_Trips\",\"score\":0.0,\"periods\":{\"weekly\":{\"start\":1472853600000,\"period\":604800000,\"identifier\":\"weekly\",\"instances\":[]}}},{\"id\":\"1\",\"name\":\"green leaves\",\"badgeEarned\":[]},{\"id\":\"1\",\"name\":\"bike aficionado\",\"badgeEarned\":[]},{\"id\":\"1\",\"name\":\"Bus_Trips\",\"score\":0.0,\"periods\":{\"weekly\":{\"start\":1472853600000,\"period\":604800000,\"identifier\":\"weekly\",\"instances\":[]}}},{\"id\":\"1\",\"name\":\"park and ride pioneer\",\"badgeEarned\":[]},{\"id\":\"1\",\"name\":\"Recommendations\",\"score\":0.0,\"periods\":{\"weekly\":{\"start\":1472853600000,\"period\":604800000,\"identifier\":\"weekly\",\"instances\":[]}}},{\"id\":\"1\",\"name\":\"ZeroImpact_Trips\",\"score\":2.0,\"periods\":{\"weekly\":{\"start\":1472853600000,\"period\":604800000,\"identifier\":\"weekly\",\"instances\":[{\"score\":0.0,\"start\":1472853600000,\"end\":1473458400000,\"index\":0},{\"score\":0.0,\"start\":1473458400000,\"end\":1474063200000,\"index\":1},{\"score\":0.0,\"start\":1474063200000,\"end\":1474668000000,\"index\":2},{\"score\":0.0,\"start\":1474668000000,\"end\":1475272800000,\"index\":3},{\"score\":0.0,\"start\":1475272800000,\"end\":1475877600000,\"index\":4},{\"score\":0.0,\"start\":1475877600000,\"end\":1476482400000,\"index\":5},{\"score\":2.0,\"start\":1476482400000,\"end\":1477087200000,\"index\":6}]}}},{\"id\":\"1\",\"name\":\"Train_Km\",\"score\":0.0,\"periods\":{\"weekly\":{\"start\":1472853600000,\"period\":604800000,\"identifier\":\"weekly\",\"instances\":[]}}},{\"id\":\"1\",\"name\":\"Walk_Km\",\"score\":3.1151920756582716,\"periods\":{\"weekly\":{\"start\":1472853600000,\"period\":604800000,\"identifier\":\"weekly\",\"instances\":[{\"score\":0.0,\"start\":1472853600000,\"end\":1473458400000,\"index\":0},{\"score\":0.0,\"start\":1473458400000,\"end\":1474063200000,\"index\":1},{\"score\":0.0,\"start\":1474063200000,\"end\":1474668000000,\"index\":2},{\"score\":0.0,\"start\":1474668000000,\"end\":1475272800000,\"index\":3},{\"score\":0.0,\"start\":1475272800000,\"end\":1475877600000,\"index\":4},{\"score\":0.0,\"start\":1475877600000,\"end\":1476482400000,\"index\":5},{\"score\":3.1151920756582716,\"start\":1476482400000,\"end\":1477087200000,\"index\":6}]}}},{\"id\":\"1\",\"name\":\"sustainable life\",\"badgeEarned\":[\"1_zero_impact_trip\"]},{\"id\":\"1\",\"name\":\"NoCar_Trips\",\"score\":2.0,\"periods\":{\"weekly\":{\"start\":1472853600000,\"period\":604800000,\"identifier\":\"weekly\",\"instances\":[{\"score\":0.0,\"start\":1472853600000,\"end\":1473458400000,\"index\":0},{\"score\":0.0,\"start\":1473458400000,\"end\":1474063200000,\"index\":1},{\"score\":0.0,\"start\":1474063200000,\"end\":1474668000000,\"index\":2},{\"score\":0.0,\"start\":1474668000000,\"end\":1475272800000,\"index\":3},{\"score\":0.0,\"start\":1475272800000,\"end\":1475877600000,\"index\":4},{\"score\":0.0,\"start\":1475877600000,\"end\":1476482400000,\"index\":5},{\"score\":2.0,\"start\":1476482400000,\"end\":1477087200000,\"index\":6}]}}},{\"id\":\"1\",\"name\":\"PandR_Trips\",\"score\":0.0,\"periods\":{\"weekly\":{\"start\":1472853600000,\"period\":604800000,\"identifier\":\"weekly\",\"instances\":[]}}},{\"id\":\"1\",\"name\":\"Bus_Km\",\"score\":0.0,\"periods\":{\"weekly\":{\"start\":1472853600000,\"period\":604800000,\"identifier\":\"weekly\",\"instances\":[]}}},{\"id\":\"1\",\"name\":\"Bike_Trips\",\"score\":0.0,\"periods\":{\"weekly\":{\"start\":1472853600000,\"period\":604800000,\"identifier\":\"weekly\",\"instances\":[]}}}]\"";
		Record record = new Record();
		record.setType(RecordType.ACTION);
		record.setContent(recordContent);
		record.setIndexType(recordContent.indexOf("type=Action"));
		String result = recordManager.analizzaAction(record);
	}

	@Test
	public void testBadgeCollection() {
		RecordManager recordManager = new RecordManager();

		String recordContent = "INFO - \"57ac710fd4c6ac7872b0e7a1\" \"24340\" 4ec61032-b3eb-48d0-bd92-3bd51c71250c 1477087206137 1477087209605 type=BadgeCollectionConcept ruleName=\"1st of the week\" name=\"leaderboard top 3\" badges=\"[2nd_of_the_week, 1st_of_the_week]\"";
		Record record = new Record();
		record.setType(RecordType.RULE_BADGECOLLECTIONCONCEPT);
		record.setContent(recordContent);
		record.setIndexType(recordContent.indexOf("type=BadgeCollectionConcept"));
		String result = recordManager.analizzaBadgeCollection(record);
	}
}
